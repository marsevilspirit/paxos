# Paxos 共识算法实现

这是一个基于消息队列的 Paxos 共识算法实现，使用内存中的消息传递来模拟分布式系统的行为。

## 项目结构

```
paxos/
├── message.go          # 消息定义和接口
├── network.go          # 网络通信层
├── acceptor.go         # 接受者状态机
├── proposer.go         # 提议者状态机
├── learner.go          # 学习者状态机
├── paxos_test.go       # 测试文件
└── README.md           # 项目说明
```

## 核心组件

### 1. Message (消息)
- 定义了 Paxos 算法中使用的消息类型
- 包括 Prepare、Accept、PrepareResponse、AcceptResponse 等消息类型
- 实现了 `message` 接口，支持网络传输

### 2. Network (网络层)
- `paxosNetwork`: 管理所有代理的消息队列
- `agentNetwork`: 每个代理的网络接口
- 支持异步消息传递和超时处理

### 3. Acceptor (接受者)
- 维护承诺的提案编号和已接受的值
- 处理 Prepare 和 Accept 请求
- 自动通知学习者已接受的值
- 实现 Paxos 算法的核心逻辑

### 4. Proposer (提议者)
- 发起提案并协调两阶段提交
- 生成唯一的提案编号
- 管理提案的生命周期
- 支持并发提案处理

### 5. Learner (学习者)
- 学习已达成共识的值
- 统计多数派支持
- 提供共识查询接口
- 支持异步学习

## 使用方法

```go
// 创建网络
pn := newPaxosNetwork(1, 2, 3, 1001, 2001)

// 创建接受者
as := make([]*acceptor, 0)
for i := 1; i <= 3; i++ {
    as = append(as, newAcceptor(i, pn.agentNetwork(i), 2001))
}

// 启动接受者
for _, a := range as {
    go a.run()
}

// 创建提议者
p := newProposer(1001, "hello world", pn.agentNetwork(1001), 1, 2, 3)
go p.run()

// 创建学习者
l := newLearner(2001, pn.agentNetwork(2001), 1, 2, 3)
value := l.learn()
```

## 算法特点

1. **消息驱动**：通过消息传递实现组件间通信
2. **异步处理**：支持并发提案和异步学习
3. **网络模拟**：使用内存队列模拟真实网络
4. **完整实现**：包含 Paxos 算法的所有核心逻辑

## 优势

- **易于理解**：消息传递模型更直观
- **便于测试**：可以轻松模拟各种场景
- **快速调试**：没有真实网络延迟
- **教学友好**：适合学习 Paxos 算法原理
- **并发支持**：支持多个提议者并发提案

## 测试场景

### 单提议者测试
- 验证基本的提案流程
- 确保共识正确达成

### 多提议者测试
- 验证并发提案处理
- 确保第一个提案优先达成共识
- 验证 Paxos 算法的安全性

## 注意事项

这个实现主要用于学习和理解 Paxos 算法，不适用于生产环境。生产环境需要考虑：
- 网络通信的可靠性
- 节点故障处理
- 性能优化
- 持久化存储

## 扩展建议

可以考虑添加：
- 更多测试场景
- 性能基准测试
- 故障注入测试
- 可视化界面
- 配置管理
- 日志记录
